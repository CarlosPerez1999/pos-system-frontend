<section class="w-full px-5 pb-5 flex flex-col gap-4 items-center">
  <div class="sticky w-full top-0 z-10 bg-background p-4 sm:p-6">
    <app-search-bar
      class="flex-shrink-0"
      placeholder="Search for product (name, code or SKU)"
      (onSearch)="productsService.setSearchQuery($event)"
    ></app-search-bar>
  </div>
  <app-table
    class="w-full"
    [columns]="productCols"
    [items]="productsService.products$()"
    [totalItems]="productsService.totalProducts()"
    [nextPageFn]="productsService.nextPage.bind(productsService)"
    [hasMore]="productsService.hasMore()"
    (getSelectedItemEmit)="selectedProduct.set($event)"
  >
    <app-button (clickEmitter)="openAdjustmentForm()"
      ><app-icon icon-left icon="heroicons-solid:adjustments"></app-icon>
      <span label class="line-clamp-1">Adjust stock</span>
    </app-button>
    <app-button variant="secondary" (clickEmitter)="openAdjustmentsModal()"
      ><app-icon icon-left icon="solar:document-add-bold"></app-icon>
      <span label class="line-clamp-1">See movements</span>
    </app-button>
  </app-table>
</section>

<section class="w-full px-5 pb-5 flex flex-col gap-4 items-start">
  <h4 class="text-lg sm:text-2xl font-bold text-red-500">
    Products with low stock
  </h4>
  <app-table
    class="w-full ring-2 ring-red-500 rounded-lg"
    [isSelectable]="false"
    [columns]="lowStockCols"
    [items]="inventoryService.lowStockProducts$()"
    [totalItems]="inventoryService.totalLowStock()"
    [nextPageFn]="inventoryService.nextPageLowStock.bind(inventoryService)"
    [hasMore]="inventoryService.hasMoreLowStock()"
  ></app-table>
</section>

<app-modal title="Adjust Stock" modalId="adjust-stock" type="info">
  <inventory-movement-form
    [productId]="selectedProduct()?.id ?? null"
    content
  ></inventory-movement-form>
</app-modal>

@if (modalService.isOpen('product-adjustments')) {
<app-modal
  title="Product adjustments"
  modalId="product-adjustments"
  type="info"
>
  <div content>
    <app-table
      [pageSize]="2"
      [columns]="adjustmentsCols"
      [items]="inventoryService.movements$()"
      [totalItems]="inventoryService.totalMovements()"
      [nextPageFn]="inventoryService.nextPage.bind(inventoryService)"
      [hasMore]="inventoryService.hasMore()"
    ></app-table>
  </div>
</app-modal>
}
